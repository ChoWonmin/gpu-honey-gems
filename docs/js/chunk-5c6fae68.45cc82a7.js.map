{"version":3,"sources":["webpack:///./src/render/Instancing/Instancing.vue?5df5","webpack:///./src/render/Instancing/Shader.ts","webpack:///./src/render/Instancing/Instancing.ts","webpack:///./src/render/Instancing/Instancing.ts?90aa","webpack:///./src/render/Instancing/Instancing.vue","webpack:///./src/render/Instancing/index.ts","webpack:///./src/render/Instancing/Instancing.vue?1f21"],"names":["render","_vm","this","_h","$createElement","_c","_self","attrs","staticRenderFns","vertexShader","fragmentShader","camera","scene","renderer","width","height","container","document","getElementById","clientWidth","clientHeight","position","z","vector","instances","positions","offsets","colors","orientationsStart","orientationsEnd","push","i","Math","random","set","normalize","x","y","w","geometry","maxInstancedCount","addAttribute","Float32Array","material","uniforms","time","value","sineTime","side","transparent","mesh","add","setPixelRatio","window","devicePixelRatio","setSize","appendChild","domElement","requestAnimationFrame","animate","performance","now","object","children","rotation","sin","init","dispose","components","component"],"mappings":"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","file":"js/chunk-5c6fae68.45cc82a7.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"container\"}})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","export default new (class Shader {\n  public vertexShader: string = `\n    precision highp float;\n\t\tuniform float sineTime;\n\t\tuniform mat4 modelViewMatrix;\n\t\tuniform mat4 projectionMatrix;\n\t\tattribute vec3 position;\n\t\tattribute vec3 offset;\n\t\tattribute vec4 color;\n\t\tattribute vec4 orientationStart;\n\t\tattribute vec4 orientationEnd;\n\t\tvarying vec3 vPosition;\n\t\tvarying vec4 vColor;\n\t\tvoid main(){\n\t\t\tvPosition = offset * max( abs( sineTime * 2.0 + 1.0 ), 0.5 ) + position;\n\t\t\tvec4 orientation = normalize( mix( orientationStart, orientationEnd, sineTime ) );\n\t\t\tvec3 vcV = cross( orientation.xyz, vPosition );\n\t\t\tvPosition = vcV * ( 2.0 * orientation.w ) + ( cross( orientation.xyz, vcV ) * 2.0 + vPosition );\n\t\t\tvColor = color;\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( vPosition, 1.0 );\n\t\t}\n  `;\n\n  public fragmentShader: string = `\n    precision highp float;\n\t\tuniform float time;\n\t\tvarying vec3 vPosition;\n\t\tvarying vec4 vColor;\n\t\tvoid main() {\n\t\t\tvec4 color = vec4( vColor );\n\t\t\tcolor.r += sin( vPosition.x * 10.0 + time ) * 0.01;\n\t\t\tgl_FragColor = color;\n\t\t}\n  `;\n})();\n","import { Component, Vue } from 'vue-property-decorator';\nimport * as THREE from 'three';\nimport Shader from './Shader';\n\n@Component({\n  components: {\n    //\n  },\n})\nexport default class Instancing extends Vue {\n  private camera: any = null;\n  private scene: any = null;\n  private renderer: any = null;\n\n  private width: number = -1;\n  private height: number = -1;\n\n  private init() {\n    const container = document.getElementById('container') as HTMLElement;\n\n    this.width = container.clientWidth;\n    this.height = container.clientHeight;\n\n    this.scene = new THREE.Scene();\n\n    this.camera = new THREE.PerspectiveCamera(\n      50,\n      this.width / this.height,\n      1,\n      10,\n    );\n    this.camera.position.z = 2;\n\n    // geometry\n    const vector = new THREE.Vector4();\n    const instances = 50000;\n    const positions = [];\n    const offsets = [];\n    const colors = [];\n    const orientationsStart = [];\n    const orientationsEnd = [];\n\n    positions.push(0.025, -0.025, 0);\n    positions.push(-0.025, 0.025, 0);\n    positions.push(0, 0, 0.025);\n\n    for (let i = 0; i < instances; i++) {\n      // offsets\n      offsets.push(\n        Math.random() - 0.5,\n        Math.random() - 0.5,\n        Math.random() - 0.5,\n      );\n      // colors\n      colors.push(Math.random(), Math.random(), Math.random(), Math.random());\n      // orientation start\n      vector.set(\n        Math.random() * 2 - 1,\n        Math.random() * 2 - 1,\n        Math.random() * 2 - 1,\n        Math.random() * 2 - 1,\n      );\n      vector.normalize();\n      orientationsStart.push(vector.x, vector.y, vector.z, vector.w);\n      // orientation end\n      vector.set(\n        Math.random() * 2 - 1,\n        Math.random() * 2 - 1,\n        Math.random() * 2 - 1,\n        Math.random() * 2 - 1,\n      );\n      vector.normalize();\n      orientationsEnd.push(vector.x, vector.y, vector.z, vector.w);\n    }\n\n    const geometry = new THREE.InstancedBufferGeometry();\n    geometry.maxInstancedCount = instances;\n    geometry.addAttribute(\n      'position',\n      new THREE.Float32BufferAttribute(positions, 3),\n    );\n    geometry.addAttribute(\n      'offset',\n      new THREE.InstancedBufferAttribute(new Float32Array(offsets), 3),\n    );\n    geometry.addAttribute(\n      'color',\n      new THREE.InstancedBufferAttribute(new Float32Array(colors), 4),\n    );\n    geometry.addAttribute(\n      'orientationStart',\n      new THREE.InstancedBufferAttribute(new Float32Array(orientationsStart), 4),\n    );\n    geometry.addAttribute(\n      'orientationEnd',\n      new THREE.InstancedBufferAttribute(new Float32Array(orientationsEnd), 4),\n    );\n    // material\n    const material = new THREE.RawShaderMaterial({\n      uniforms: {\n        time: { value: 1.0 },\n        sineTime: { value: 1.0 },\n      },\n      vertexShader: Shader.vertexShader,\n      fragmentShader: Shader.fragmentShader,\n      side: THREE.DoubleSide,\n      transparent: true,\n    });\n\n    const mesh = new THREE.Mesh(geometry, material);\n    this.scene.add(mesh);\n\n    this.renderer = new THREE.WebGLRenderer();\n    this.renderer.setPixelRatio(window.devicePixelRatio);\n    this.renderer.setSize(this.width, this.height);\n\n    if (container) {\n      container.appendChild(this.renderer.domElement);\n    }\n  }\n\n  private animate() {\n    requestAnimationFrame(this.animate);\n\n    const time = performance.now();\n    const object = this.scene.children[0];\n\n    object.rotation.y = time * 0.0005;\n    object.material.uniforms.time.value = time * 0.05;\n    object.material.uniforms.sineTime.value = Math.sin(\n      object.material.uniforms.time.value * 0.005,\n    );\n\n    this.renderer.render(this.scene, this.camera);\n  }\n\n  private mounted() {\n    this.init();\n    this.animate();\n  }\n\n  private beforeMount() {\n    this.scene.dispose();\n    this.renderer.dispose();\n  }\n}\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--12-3!./Instancing.ts?vue&type=script&lang=ts&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/ts-loader/index.js??ref--12-3!./Instancing.ts?vue&type=script&lang=ts&\"","import { render, staticRenderFns } from \"./Instancing.vue?vue&type=template&id=6d2a4c4f&scoped=true&lang=pug&\"\nimport script from \"./Instancing.ts?vue&type=script&lang=ts&\"\nexport * from \"./Instancing.ts?vue&type=script&lang=ts&\"\nimport style0 from \"./Instancing.vue?vue&type=style&index=0&id=6d2a4c4f&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"6d2a4c4f\",\n  null\n  \n)\n\nexport default component.exports","import Instancing from './Instancing.vue';\n\nexport default Instancing;\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../../node_modules/vuetify-loader/lib/loader.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Instancing.vue?vue&type=style&index=0&id=6d2a4c4f&lang=scss&scoped=true&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--7-oneOf-1-0!../../../node_modules/css-loader/index.js??ref--7-oneOf-1-1!../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--7-oneOf-1-2!../../../node_modules/sass-loader/dist/cjs.js??ref--7-oneOf-1-3!../../../node_modules/vuetify-loader/lib/loader.js!../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Instancing.vue?vue&type=style&index=0&id=6d2a4c4f&lang=scss&scoped=true&\""],"sourceRoot":""}